<h2>Registros</h2>

<h2>Filtrar por fecha</h2>

<form method="GET" action="/admin/registros">
    <label>Desde:</label>
    <input type="date" name="desde">

    <label>Hasta:</label>
    <input type="date" name="hasta">

    <button type="submit">Filtrar</button>
</form>

<hr>

<h3>Top 10 Ventas Más Caras</h3>
<table border="1">
  <tr>
    <th>ID</th>
    <th>Cliente</th>
    <th>Total</th>
  </tr>

  <% ventasMasCaras.forEach(venta => { %>
    <tr>
      <td><%= venta.id %></td>
      <td><%= venta.nombre_cliente %></td>
      <td>$<%= venta.total %></td>
    </tr>
  <% }) %>
</table>

<h3>Top 10 Productos Más Vendidos</h3>
<table border="1">
  <tr>
    <th>Producto</th>
    <th>Cantidad Vendida</th>
  </tr>

  <% productosMasVendidos.forEach(p => { %>
    <tr>
      <td>
        <%= p.Producto ? p.Producto.nombre : "Sin producto" %>
      </td>
      <td><%= p.dataValues.total_vendido %></td>
    </tr>
  <% }) %>
</table>

<h3>Últimos Inicios de Sesión</h3>
<table border="1">
  <tr>
    <th>Usuario</th>
    <th>Fecha</th>
    <th>Acción</th>
  </tr>

  <% logs.forEach(log => { %>
    <tr>
      <td><%= log.Usuario.email %></td>
      <td><%= new Date(log.fecha).toLocaleString() %></td>
      <td><%= log.accion %></td>
    </tr>
  <% }) %>
</table>

<h3>Estadísticas Generales</h3>
<table border="1">
  <tr>
    <th>Total Facturación</th>
    <th>Productos Activos</th>
  </tr>
  <tr>
    <td>$ <%= totalFacturacion || 0 %></td>
    <td><%= totalProductosActivos %></td>
  </tr>
</table>

<h3>Encuestas / Asistencias</h3>

<table border="1">
    <tr>
        <th>Email</th>
        <th>Opinión</th>
        <th>Puntuación</th>
        <th>Acepta Promos</th>
        <th>Fecha</th>
    </tr>

    <% encuestas.forEach(encuesta => { %>
        <tr>
            <td><%= encuesta.email %></td>
            <td><%= encuesta.opinion %></td>
            <td><%= encuesta.puntuacion %></td>
            <td><%= encuesta.acepta_promos ? "Sí" : "No" %></td>
            <td><%= new Date(encuesta.createdAt).toLocaleDateString() %></td>
        </tr>
    <% }) %>
</table>

<hr>

<h2>Resumen de Encuestas</h2>

<table border="1">
    <tr>
        <th>Total Encuestas</th>
        <th>Promedio Puntuación</th>
        <th>Aceptan Promos</th>
    </tr>
    <tr>
        <td><%= totalEncuestas %></td>
        <td><%= promedioPuntuacion.toFixed(2) %></td>
        <td><%= totalPromos %></td>
    </tr>
</table>

<a href="/admin/registros/exportar">
  <button>Descargar Excel</button>
</a>

<br>
<a href="/admin/dashboard">Volver</a>
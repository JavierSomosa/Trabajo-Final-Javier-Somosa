<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zona Gamer - Productos</title>

<link rel="stylesheet" href="css/styleProductos.css">
</head>

<body>

<button class="theme-btn" onclick="toggleTheme()">ðŸŒ™</button>

<header>
    <h1>ðŸŽ® Zona Gamer</h1>
    <nav>
        <a href="productos.html">Productos</a>
        <a href="carrito.html">Carrito</a>
        <a href="index.html">Salir</a>
    </nav>
</header>

<h2 class="titulo-seccion">Productos Disponibles</h2>

<div class="filtros">
    <button onclick="filtrar('')">Todos</button>
    <button onclick="filtrar('Juego')">Juegos</button>
    <button onclick="filtrar('PelÃ­cula')">PelÃ­culas</button>
</div>

<div id="productos" class="grid"></div>

<script>
const API_URL = "http://localhost:3000/api";
let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

async function obtenerProductos(categoria = "") {
    try {

        let url = `${API_URL}/productos`;

        if (categoria) {
            url += `?categoria=${categoria}`;
        }

        const res = await fetch(url);

        if (!res.ok) {
            throw new Error("No se pudieron obtener los productos");
        }

        const productos = await res.json();

        const contenedor = document.getElementById("productos");
        contenedor.innerHTML = "";

        if (!Array.isArray(productos) || productos.length === 0) {
            contenedor.innerHTML = "<p>No hay productos disponibles.</p>";
            return;
        }

        productos.forEach(p => {

            const precioNumero = Number(p.precio);

            contenedor.innerHTML += `
                <div class="card">
                    <img src="http://localhost:3000/uploads/${p.imagen}" 
                        alt="${p.nombre}" 
                        onerror="this.src='https://via.placeholder.com/150'" />
                    <h3>${p.nombre}</h3>
                    <p class="precio">$${precioNumero.toLocaleString()}</p>
                    <div class="acciones">
                        <button onclick="agregar(${p.id}, '${p.nombre}', ${precioNumero})">
                            Agregar
                        </button>
                        <button onclick="verDetalle(${p.id})">
                            Ver detalle
                        </button>
                    </div>
                </div>
            `;
        });

    } catch (error) {
        console.error("Error cargando productos:", error);
        document.getElementById("productos").innerHTML =
            "<p>Error al cargar productos.</p>";
    }
}

function agregar(id, nombre, precio) {
    const existente = carrito.find(p => p.id === id);
    if (existente) {
        existente.cantidad++;
    } else {
        carrito.push({ id, nombre, precio, cantidad: 1 });
    }
    localStorage.setItem("carrito", JSON.stringify(carrito));
    alert("Producto agregado");
}

function filtrar(categoria) {
    obtenerProductos(categoria);
}

function verDetalle(id) {
    window.location.href = `detalle.html?id=${id}`;
}

function toggleTheme() {
    document.body.classList.toggle("dark");
    localStorage.setItem("tema",
        document.body.classList.contains("dark") ? "dark" : "light"
    );
}

window.onload = function () {
    if (localStorage.getItem("tema") === "dark") {
        document.body.classList.add("dark");
    }
    obtenerProductos();
};
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zona Gamer - Productos</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

nav a {
    margin-left: 15px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    gap: 20px;
    margin-top: 20px;
}

.card {
    border: 1px solid #ccc;
    padding: 15px;
    text-align: center;
}

img {
    max-width: 100%;
    height: 150px;
    object-fit: contain;
}

button {
    padding: 6px 10px;
    cursor: pointer;
}

.dark {
    background-color: #121212;
    color: white;
}

.dark .card {
    border: 1px solid #444;
}

.dark button {
    background: #333;
    color: white;
    border: 1px solid #555;
}

.theme-btn {
    position: absolute;
    top: 10px;
    right: 10px;
}
</style>
</head>

<body>

<button class="theme-btn" onclick="toggleTheme()">Cambiar tema</button>

<header>
    <h1>ðŸŽ® Zona Gamer</h1>
    <nav>
        <a href="productos.html">Productos</a>
        <a href="carrito.html">Carrito</a>
        <a href="index.html">Salir</a>
    </nav>
</header>

<h2>Productos Disponibles</h2>

<div id="productos" class="grid"></div>

<script>
const API_URL = "http://localhost:3000/api";
let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

async function obtenerProductos() {
    try {
        const res = await fetch(`${API_URL}/productos`);

        if (!res.ok) {
            throw new Error("No se pudieron obtener los productos");
        }

        const productos = await res.json();

        const contenedor = document.getElementById("productos");
        contenedor.innerHTML = "";

        if (!Array.isArray(productos) || productos.length === 0) {
            contenedor.innerHTML = "<p>No hay productos disponibles.</p>";
            return;
        }

        productos.forEach(p => {

            const precioNumero = Number(p.precio);

            contenedor.innerHTML += `
                <div class="card">
                    <img src="http://localhost:3000/uploads/${p.imagen}" 
                         alt="${p.nombre}" 
                         onerror="this.src='https://via.placeholder.com/150'" />
                    <h3>${p.nombre}</h3>
                    <p>$${precioNumero.toLocaleString()}</p>
                    <button onclick="agregar(${p.id}, '${p.nombre}', ${precioNumero})">
                        Agregar
                    </button>
                </div>
            `;
        });

    } catch (error) {
        console.error("Error cargando productos:", error);
        document.getElementById("productos").innerHTML =
            "<p>Error al cargar productos.</p>";
    }
}

function agregar(id, nombre, precio) {
    const existente = carrito.find(p => p.id === id);
    if (existente) {
        existente.cantidad++;
    } else {
        carrito.push({ id, nombre, precio, cantidad: 1 });
    }
    localStorage.setItem("carrito", JSON.stringify(carrito));
    alert("Producto agregado");
}

function toggleTheme() {
    document.body.classList.toggle("dark");
    localStorage.setItem("tema",
        document.body.classList.contains("dark") ? "dark" : "light"
    );
}

window.onload = function () {
    if (localStorage.getItem("tema") === "dark") {
        document.body.classList.add("dark");
    }
    obtenerProductos();
};
</script>

</body>
</html>